{{define "edit-content"}}
    <article class="page">
        <h2>{{if .Page}}Edit{{else}}Create{{end}}: {{.Title}}</h2>
        
        <form method="POST" action="/{{.Path}}?action=save" class="edit-form">
            <div class="form-group">
                <div id="pm-editor" class="edit-prosemirror"></div>
                <textarea name="content" id="editor-source" hidden>{{if .Page}}{{.Page.Content}}{{end}}</textarea>
                <input type="hidden" name="docmodel" id="docmodel-json">
                <script id="docmodel-source" type="application/json">{{.DocModelJSON}}</script>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="save-button">Save</button>
                <a href="/{{.Path}}" class="cancel-button">Cancel</a>
            </div>
        </form>
    </article>

    <script src="/static/editor/prosemirror.bundle.js"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function () {
        if (!window.initProseMirrorEditor) return;

        const container = document.getElementById("pm-editor");
        const data = document.getElementById("docmodel-source");

        console.log("Initializing ProseMirror editor", container, data);

        if (!container || !data) { console.log("Missing container or data", container, data); return; }

        const doc = JSON.parse(data.textContent);
        window.initProseMirrorEditor(container, doc);
    });
    </script>
{{end}}
